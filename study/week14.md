Week 14 (02/05 ~ 02/07)
===
>  ##### 주간 요약
>  프로젝트 베이스라인을 직접 구축했다.  
>  Valid score와 LB score가 align 되도록 valid data를 만들었다.  
>  FM 모델과 logistic FM 모델을 구현했다.  
>  파이프라인의 시간 복잡도를 개선했다.  

Day 63 (02/05)
---
오늘은 큰 작업보다는 지난 작업들을 한 번 갈무리하고 가는 시간을 가졌다.  
미리 구현해 둔 MF와 LMF 모델의 하이퍼 파라미터 튜닝을 위해 학습을 돌려놓고, 주말동안 구축한 베이스라인 코드에 대한 리뷰 사항들을 반영했다.  
주말동안 시간복잡도 최적화 등 여러 부분에서 코드를 가다듬어서 기능적인 변경 사항은 거의 없었다.  
loss 계산에 대해 개선사항을 건의해주신 분이 계셔서 해당 부분을 변경했더니 학습 속도가 많이 빨라져서 실험을 하기 더 용이해졌다.  
그 외에는 코드에 대한 질의응답이나 type hint, doc string 등에 대한 내용이었다.  
나름 베이스라인 코드를 깔끔하게 완성한 것 같아서 뿌듯하다.  

그리고 Valid data도 만들어서 LB score와 align을 하는 데 성공했다.  
Valid score 0.1208 / LB score 0.1198으로 꽤나 align이 잘 된 것 같다.  
베이스라인 코드를 다듬으며 돌려둔 학습 결과인데, 튜닝에 따라서 좀 더 성능이 올라갈 것 같기도 하다.  

내일부터는 현재 모델을 튜닝하면서 Convolutional FM을 구현해 볼 예정이다.  
FM의 feature간 interaction 계산을 image화 해서 CNN으로 학습하는 모델인데, feature 학습에 CNN을 사용한다는 점이 신기해서 도전해 보고 싶어졌다.  
관련 논문에서 MovieLens 데이터에 대해 FM이나 DeepFM보다 성능이 좋다는 결과도 있어서 더 시도해 볼 가치가 있는 것 같다.  

+ ##### 베이스라인 구축, Valid-LB align

Day 64 (02/06)
---
오늘은 FM을 구현했다.  
미션 등으로 몇 번 구현해 봤기에 별로 어려울 거라 생각하지 않았는데, 예상치 못한 문제가 많아서 오래 걸렸다.  
Genre라는 feature에 여러 값이 동시에 들어갈 수 있어서 multi-hot encoding을 한 후 처리해야 한다거나, 결측치를 감안하여 zero-padding을 해야 하는 등의 문제가 있었다.  
그리고 단순히 예측값을 내놓는 것이 목표가 아니라, 예측값을 통해 추천을 할 수 있도록 구조를 짜야 하는 점도 생각보다 장애요소였다.  
아무튼 결과적으로 구현은 성공해서 모델을 돌려보는 중이다.  
Side information을 활용하는 모델이라 feature engineering의 영향을 많이 받을 것 같은데, 그래서인지 아직은 성능이 많이 떨어지는 상태다.  
그래도 FM은 이후에 DeepFM이나 Convolutional FM을 만들기 위한 base 모델의 역할도 하기 때문에 구현할 가치는 충분했다고 생각한다.  

+ ##### FM 모델 구현

Day 65 (02/07)
---
오늘은 파이프라인의 시간 복잡도를 개선했다.  
매 epoch마다 유저들에게 10개의 아이템을 추천하고 recall을 확인해야 하는데, 이 과정이 꽤 느리다고 느꼈다.  
그래서 학습 속도를 개선하기 위해 10개를 추천하는 함수의 시간 복잡도를 개선하기로 했다.  
logic을 떠올리는 건 어렵지 않았다. 단순하게 time-memory trade off를 이용해서 한 유저씩 추천하던 걸 여러 유저에 대해 batch로 처리하는 방식으로 변경했다.  
그리고 추천 아이템 목록을 매번 concatenate를 하며 늘리는 것은 메모리 재할당 때문에 속도가 느려질 것 같아서 미리 메모리를 확보 후 적절한 indexing으로 값을 할당하도록 변경했다.  
방식은 간단한데 numpy, pandas, torch 객체를 넘나들면서 데이터를 다뤄야 해서 에러가 너무 많이 발생했다.  
덕분에 구현해보려던 Convolutional FM은 내일로 미루고 오늘 하루종일 이 작업만 진행했다.  

그래도 결과적으로 5분이 걸리던 추천을 1분 30초 정도로 줄였으니 시간을 30% 정도로 줄인 셈이다.  
덕분에 모델 학습 속도가 빨라졌고, 지금은 이걸 바탕으로 FM과 logistic FM의 sweep을 돌리는 중이다.  
logistic MF도 있으니까 비슷한 방식의 FM도 logistic 방식을 적용할 수 있지 않을까 싶어 구현해봤는데, 확실히 그냥 FM보다는 성능이 나은 것 같다.  
하지만 아직 하이퍼파라미터 튜닝이 잘 되지 않아서인지 MF에 비해 성능이 한참 떨어진다.  
Side information을 활용하는 모델인데 아직 feature engineering을 하지 않아서 그런 것일 수도 있겠다.  
다행히 다른 조원분께서 feature engineering을 해 주기로 하셔서 다가올 연휴가 지나면 FM을 제대로 활용해 볼 수 있지 않을까 싶다.  

+ ##### 파이프라인 시간 복잡도 개선
